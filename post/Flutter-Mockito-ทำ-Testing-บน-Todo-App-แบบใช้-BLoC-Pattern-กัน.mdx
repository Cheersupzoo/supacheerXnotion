---
title: 'Flutter Mockito: ทำ Testing บน Todo App แบบใช้ BLoC Pattern กัน'
description: ต่อเนื่องมาจาก
date: ''
categories: []
keywords: []
slug: 'Flutter-Mockito-ทำ-Testing-บน-Todo-App-แบบใช้-BLoC-Pattern-กัน'
type: 'blog'
draft: true
---

ต่อเนื่องมาจาก

[**Flutter: ลองสร้าง Todo App โดยใช้ BLoC Pattern กัน**  
_หลังจากบล็อกที่แล้ว เราลองทำความเข้าใจ bloc pattern แบบเบื้องต้น กับ increment app เพื่อให้เข้าใจพื้นฐาน…_medium.com](https://medium.com/@cheersupzoo/flutter-%E0%B8%A5%E0%B8%AD%E0%B8%87%E0%B8%AA%E0%B8%A3%E0%B9%89%E0%B8%B2%E0%B8%87-todo-app-%E0%B9%82%E0%B8%94%E0%B8%A2%E0%B9%83%E0%B8%8A%E0%B9%89-bloc-pattern-%E0%B8%81%E0%B8%B1%E0%B8%99-b7810c99bf32 "https://medium.com/@cheersupzoo/flutter-%E0%B8%A5%E0%B8%AD%E0%B8%87%E0%B8%AA%E0%B8%A3%E0%B9%89%E0%B8%B2%E0%B8%87-todo-app-%E0%B9%82%E0%B8%94%E0%B8%A2%E0%B9%83%E0%B8%8A%E0%B9%89-bloc-pattern-%E0%B8%81%E0%B8%B1%E0%B8%99-b7810c99bf32")[](https://medium.com/@cheersupzoo/flutter-%E0%B8%A5%E0%B8%AD%E0%B8%87%E0%B8%AA%E0%B8%A3%E0%B9%89%E0%B8%B2%E0%B8%87-todo-app-%E0%B9%82%E0%B8%94%E0%B8%A2%E0%B9%83%E0%B8%8A%E0%B9%89-bloc-pattern-%E0%B8%81%E0%B8%B1%E0%B8%99-b7810c99bf32)

มาต่อยอดทำระบบทดสอบฟีเจอร์กัน

ก่อนหน้านี้เราต้อง manual เทสมือกันเองหมดเลย บางครั้งเราทำฟีเจอร์ใหม่มา เราก็เริ่มขี้เกียจเทสฟีเจอร์ก่อนหน้า แต่ถ้าไม่เทส เราก็จะไม่รู้ว่าเผลอไปกระทบการทำงานส่วนไหนรึเปล่า เพราะฉะนั้น เรามาทำ Widget Testing ด้วย Mockito กัน และด้วยการที่เราใช้ BloC Pattern เราจะใช้ bloc_testing เข้ามาช่วยในการเขียนแบบทดสอบ

เพื่อความกระชับในบทความนี้ เราจะทดสอบเฉพาะ Widget Testing ซึ่งจะเป็นความกึ่งๆ การทำ Unit Test ที่มีส่วน UI เข้ามาเทสด้วย แต่ก็ไม่ได้มีสเต็ปการทดสอบที่ซับซ้อนเท่า Integration Testing ที่จะเทส Flow การใช้งานตั้งแต่ต้นจนจบ ถ้าใครคล่องแล้วก็อ่านผ่านๆได้เลย

หรือจะโหลดไฟล์ก่อนหน้ามาทำตามได้จาก [Github](https://github.com/Cheersupzoo/simple_todos_bloc) นี้

#### มาทำความเข้าใจ Widget Testing กันก่อน

คร่าวๆ Widget Testing คือการทดสอบเพื่อเช็คว่า Widget ทำงานตรงกับความตั้งใจของเรามั้ย เช่น เรามี Widget **Text** เมื่อเราสร้างมันขึ้นมา เราเช็คเข้าไป เราก็ต้องเจอ Text นั้นๆ ถ้าไม่เจอ แสดงว่าเราอาจจะทำบางสิ่งผิดพลาด เช่น อาจะเผลอไปแก้ฝังค่าไว้ชั่วคราว แล้วลืมแก้กลับ การเขียน Widget Testing ที่ดีก็จะช่วยดักความผิดพลาดส่วนนี้ได้ โดยเฉพาะอย่างยิ่ง เวลาโค๊ดเราเริ่มมีขนาดใหญ่ การแบ่งเวลามาเขียนพวกนี้ จะช่วยประหยัดเวลาได้มากถ้าเราต้องมานั่งแก้ในภายหลัง

### มาดูโค๊ดกัน

ในโฟลเดอร์ `test/` เราจะเจอไฟล์ `widget_test.dart` ที่ถูกสร้างตอนเราสร้างโปรเจค เราจะมาแก้ที่นี่กัน

เราจะเจอโค๊ดเดิม มีไว้สำหรับเทส Counter Increment

![](/img/1__P9GNq__hc__8HAyjW__WuIp8g.png)

ถ้าโค๊ดยังไม่ได้ถูกแก้ไขหลังสร้างโปรเจค เทสนี้จะมีสเต็ปการรันดังนี้

1.  สร้างสภาพแวดล้อมสำหรับเทส Widget MyApp()
2.  เช็คว่ามีตัวอักษร ‘0’ 1 ตัวใน Widget และไม่มี ‘1’ ใน Widget
3.  กดปุ่มที่มีเครื่องหมาย ‘+’ แล้วรอ Widget อัพเดทผลลัพท์
4.  เช็คว่าไม่มีตัวอักษร ‘0’ ใน Widget และมี ‘1’ 1 ตัว ใน Widget

แต่เราเปลี่ยนหน้าตา UI Widget ไปหมดแล้ว ดังนั้น `**testWidgets**` เดิมเราจะใช้การไม่ได้แล้ว

#### มาเทสกันแบบ basic กันก่อน

เพื่อความเป็นระเบียบเรียบร้อยเราจะมีการใส่ `**group**` ด้วย อยู่ใน main() เหมือนเดิม ให้เป็นตามนี้

![](/img/1__y__79lefCfCHKAc2mRUEgLw.png)

ตามที่อธิบายในรูป เราแค่เช็คความเรียบร้อยว่า ok เราตั้งใจให้ Widget LoadingIndicator() มี Widget ที่มี Key(“loading_indicator”) อยู่ 1 อัน ซึ่งควรจะมีตามนี้ ถ้ามีใครไปแก้ให้ต่างไปจากนี้ เราก็จะทราบได้จาก error ที่ขึ้นมา

![](/img/1__294YBDFOoxYP__5MJg7hu8g.png)

ลองรัน `flutter test` แล้วก็จะ **passed!** ตามรูปเลย

### มาเทส Widget Screen ที่เชื่อมกับ bloc กัน

เราจะแยกเป็น 2 group

*   todosScreen
*   DetailAddScreen